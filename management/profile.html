<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Management - Portfolio Admin</title>
    <link rel="stylesheet" href="shared-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <h1>Profile Management</h1>
            <nav class="admin-nav">
                <a href="index.html">Content</a>
                <a href="categories.html">Categories</a>
                <a href="profile.html" class="active">Profile</a>
                <a href="../index.html" class="btn-secondary">‚Üê Back to Portfolio</a>
            </nav>
        </header>

        <main class="admin-main">
            <!-- Personal Information Section -->
            <section class="admin-section">
                <h2>Personal Information</h2>
                
                <form id="personalInfoForm" class="admin-form">
                    <div class="form-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" required placeholder="Your Full Name">
                    </div>
                    
                    <div class="form-group">
                        <label for="location">Location *</label>
                        <input type="text" id="location" required placeholder="City, State">
                    </div>

                    <div class="form-divider">
                        <h3>Job Titles (Combined Title + Employer)</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="jobTitle1">Job Title 1 * (Required)</label>
                        <input type="text" id="jobTitle1" required placeholder="e.g., Brand Journalist at Axway">
                        <small>Format: "Title at Company" - This will appear on line 3</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="jobTitle2">Job Title 2 (Optional)</label>
                        <input type="text" id="jobTitle2" placeholder="e.g., Correspondent at the LCB">
                        <small>Optional second title - This will appear on line 4</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="jobTitle3">Job Title 3 (Optional)</label>
                        <input type="text" id="jobTitle3" placeholder="e.g., Editor of Ask a Pol">
                        <small>Optional third title - This will appear on line 5</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="jobTitle4">Job Title 4 (Optional)</label>
                        <input type="text" id="jobTitle4" placeholder="e.g., Additional title">
                        <small>Optional fourth title - This will appear on line 6</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileImage">Profile Image URL</label>
                        <input type="url" id="profileImage" placeholder="https://example.com/your-photo.jpg">
                        <small>Upload your photo to a hosting service, then paste the URL here (currently hidden on site)</small>
                    </div>

                    <div class="form-divider">
                        <h3>Contact Information</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="your.email@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" placeholder="+1 (555) 123-4567">
                    </div>
                    
                    <div class="form-group">
                        <label for="linkedin">LinkedIn Profile</label>
                        <input type="url" id="linkedin" placeholder="https://linkedin.com/in/yourname">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Save Personal Information</button>
                    </div>
                </form>

                <div id="personalInfoStatus" class="message" style="display: none;"></div>
            </section>

            <!-- Bio & Professional Details Section -->
            <section class="admin-section">
                <h2>Professional Bio</h2>
                
                <form id="bioForm" class="admin-form">
                    <div class="form-group">
                        <label for="shortBio">Short Bio (collapsed header) *</label>
                        <textarea id="shortBio" required rows="4" placeholder="Brief professional summary that appears in the collapsed header..."></textarea>
                        <small>Appears on the right side when header is collapsed. Keep concise but informative.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="fullBio">Full Bio (expanded header)</label>
                        <textarea id="fullBio" rows="10" placeholder="Detailed professional biography that appears when header is expanded. You can use HTML tags like <p>, <strong>, <ul>, etc."></textarea>
                        <small>This appears when header is expanded. Can include multiple paragraphs and HTML formatting.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="skills">Skills (comma-separated)</label>
                        <input type="text" id="skills" placeholder="Investigative Reporting, Breaking News, Video Production, Social Media">
                        <small>Separate each skill with a comma. Appears in expanded header on the right side.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="languages">Languages (comma-separated)</label>
                        <input type="text" id="languages" placeholder="English (Native), Spanish (Fluent), French (Conversational)">
                        <small>Separate each language with a comma. Appears in expanded header on the right side.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="education">Education</label>
                        <input type="text" id="education" placeholder="Bachelor's in Journalism, Master's in Communications">
                        <small>Appears in expanded header on the right side.</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Save Bio & Details</button>
                    </div>
                </form>

                <div id="bioStatus" class="message" style="display: none;"></div>
            </section>

            <!-- Display Settings Section -->
            <section class="admin-section">
                <h2>Display Settings</h2>
                
                <form id="settingsForm" class="admin-form">
                    <div class="form-group">
                        <label>Contact Display Options</label>
                        <div style="display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap;">
                            <label style="font-weight: normal; display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="checkbox" id="showEmail" checked> Show Email
                            </label>
                            <label style="font-weight: normal; display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="checkbox" id="showPhone" checked> Show Phone
                            </label>
                            <label style="font-weight: normal; display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="checkbox" id="showSocialMedia" checked> Show Social Media
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Save Display Settings</button>
                        <button type="button" class="btn-secondary" onclick="previewBusinessCard()">Preview on Main Site</button>
                    </div>
                </form>

                <div id="settingsStatus" class="message" style="display: none;"></div>
            </section>
        </main>
    </div>

    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../supabase-config.js"></script>
    <script src="../content.js"></script>
    
    <script>
        // Load existing profile data into forms
        async function loadProfileData() {
            const profile = await getProfileData();
            
            // Load personal information
            if (profile.personalInfo) {
                document.getElementById('fullName').value = profile.personalInfo.fullName || '';
                document.getElementById('location').value = profile.personalInfo.location || '';
                document.getElementById('jobTitle1').value = profile.personalInfo.jobTitle1 || '';
                document.getElementById('jobTitle2').value = profile.personalInfo.jobTitle2 || '';
                document.getElementById('jobTitle3').value = profile.personalInfo.jobTitle3 || '';
                document.getElementById('jobTitle4').value = profile.personalInfo.jobTitle4 || '';
                document.getElementById('profileImage').value = profile.personalInfo.profileImage || '';
                document.getElementById('email').value = profile.personalInfo.email || '';
                document.getElementById('phone').value = profile.personalInfo.phone || '';
                document.getElementById('linkedin').value = profile.personalInfo.linkedin || '';
            }
            
            // Load bio information
            if (profile.bioInfo) {
                document.getElementById('shortBio').value = profile.bioInfo.shortBio || '';
                document.getElementById('fullBio').value = profile.bioInfo.fullBio || '';
                document.getElementById('skills').value = profile.bioInfo.skills ? profile.bioInfo.skills.join(', ') : '';
                document.getElementById('languages').value = profile.bioInfo.languages ? profile.bioInfo.languages.join(', ') : '';
                document.getElementById('education').value = profile.bioInfo.education || '';
            }
            
            // Load display settings
            if (profile.displaySettings) {
                document.getElementById('showEmail').checked = profile.displaySettings.showEmail !== false;
                document.getElementById('showPhone').checked = profile.displaySettings.showPhone !== false;
                document.getElementById('showSocialMedia').checked = profile.displaySettings.showSocialMedia !== false;
            }
        }

        // Save personal information
        document.getElementById('personalInfoForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = this.querySelector('.btn-primary');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const profile = await getProfileData();
                
                profile.personalInfo = {
                    fullName: document.getElementById('fullName').value.trim(),
                    location: document.getElementById('location').value.trim(),
                    jobTitle1: document.getElementById('jobTitle1').value.trim(),
                    jobTitle2: document.getElementById('jobTitle2').value.trim(),
                    jobTitle3: document.getElementById('jobTitle3').value.trim(),
                    jobTitle4: document.getElementById('jobTitle4').value.trim(),
                    profileImage: document.getElementById('profileImage').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    linkedin: document.getElementById('linkedin').value.trim()
                };
                
                await updateProfile(profile);
                showStatus('personalInfoStatus', 'Personal information saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving personal info:', error);
                showStatus('personalInfoStatus', 'Error saving: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Personal Information';
            }
        });

        // Save bio and professional details
        document.getElementById('bioForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = this.querySelector('.btn-primary');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const profile = await getProfileData();
                
                profile.bioInfo = {
                    shortBio: document.getElementById('shortBio').value.trim(),
                    fullBio: document.getElementById('fullBio').value.trim(),
                    skills: document.getElementById('skills').value ? 
                        document.getElementById('skills').value.split(',').map(s => s.trim()).filter(s => s) : [],
                    languages: document.getElementById('languages').value ? 
                        document.getElementById('languages').value.split(',').map(s => s.trim()).filter(s => s) : [],
                    education: document.getElementById('education').value.trim()
                };
                
                await updateProfile(profile);
                showStatus('bioStatus', 'Bio and details saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving bio:', error);
                showStatus('bioStatus', 'Error saving: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Bio & Details';
            }
        });

        // Save display settings
        document.getElementById('settingsForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = this.querySelector('.btn-primary');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const profile = await getProfileData();
                
                profile.displaySettings = {
                    showEmail: document.getElementById('showEmail').checked,
                    showPhone: document.getElementById('showPhone').checked,
                    showSocialMedia: document.getElementById('showSocialMedia').checked
                };
                
                await updateProfile(profile);
                showStatus('settingsStatus', 'Display settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showStatus('settingsStatus', 'Error saving: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Display Settings';
            }
        });

        // Preview business card
        function previewBusinessCard() {
            window.open('../index.html', '_blank');
        }

        // Show status message
        function showStatus(elementId, message, type) {
            const statusDiv = document.getElementById(elementId);
            statusDiv.textContent = message;
            statusDiv.className = `message ${type}`;
            statusDiv.style.display = 'block';

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Profile page loaded, loading data...');
            await loadProfileData();
            console.log('Profile page initialization complete!');
        });
    </script>
</body>
</html>