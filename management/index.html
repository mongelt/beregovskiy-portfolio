<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Management - Portfolio Admin</title>
    <link rel="stylesheet" href="shared-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Content Management</h1>
            <p>Add, edit, and manage your portfolio content</p>
        </div>
        
        <div class="navigation">
            <a href="index.html" class="nav-button active">Content Management</a>
            <a href="categories.html" class="nav-button">Manage Categories</a>
            <a href="profile.html" class="nav-button">Business Card</a>
            <a href="../index.html" class="nav-button secondary">View Website</a>
        </div>
        
        <!-- Login Section -->
        <div class="login-section" id="loginSection">
            <h2>Admin Login</h2>
            <div class="form-group">
                <input type="password" id="passwordInput" placeholder="Enter admin password" style="max-width: 300px; margin: 20px auto;">
            </div>
            <button onclick="login()">Access Content Management</button>
            <p style="margin-top: 20px; color: #666; font-size: 14px;">
                Password: <strong>portfolio2024</strong>
            </p>
        </div>
        
        <!-- Content Management Section -->
        <div class="admin-section" id="adminSection">
            
            <!-- Content Form -->
            <div id="contentFormSection">
                <h2>Content Editor</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="contentType">Content Type:</label>
                        <select id="contentType">
                            <option value="article">Article</option>
                            <option value="image">Image</option>
                            <option value="video">Video</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="contentCategory">Category:</label>
                        <select id="contentCategory" onchange="updateSubcategoryOptions()">
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="contentSubcategory">Subcategory:</label>
                        <select id="contentSubcategory">
                            <option value="">Select Subcategory</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="contentTitle">Title:</label>
                    <input type="text" id="contentTitle" placeholder="Enter content title">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sidebarTitle">Sidebar Title (optional):</label>
                        <input type="text" id="sidebarTitle" placeholder="Different title for sidebar">
                        <small>Leave blank to use main title</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="sidebarSubtitle">Sidebar Subtitle (optional):</label>
                        <input type="text" id="sidebarSubtitle" placeholder="Brief subtitle for sidebar">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="contentEditor">Content:</label>
                    <textarea id="contentEditor" placeholder="Write your content here. You can use basic HTML tags like &lt;h3&gt;, &lt;p&gt;, &lt;strong&gt;, etc." style="min-height: 200px;"></textarea>
                    <small>You can use HTML tags for formatting: &lt;h3&gt;Heading&lt;/h3&gt;, &lt;p&gt;Paragraph&lt;/p&gt;, &lt;strong&gt;Bold&lt;/strong&gt;, &lt;em&gt;Italic&lt;/em&gt;</small>
                </div>
                
                <div class="form-group">
                    <label for="mediaUrl">Media URL (optional):</label>
                    <input type="url" id="mediaUrl" placeholder="Paste image or video URL here">
                    <small>Upload to ImgBB, YouTube, etc. and paste URL here</small>
                </div>
                
                <div style="display: flex; gap: 10px; align-items: center; margin: 20px 0;">
                    <button type="button" onclick="publishContent()" class="add-btn">
                        <i class="fas fa-plus"></i> <span id="buttonText">Add Content</span>
                    </button>
                    <button type="button" id="cancelEditBtn" onclick="cancelEdit()" style="display: none;">
                        <i class="fas fa-times"></i> Cancel Edit
                    </button>
                    <button type="button" onclick="previewContent()" class="secondary">
                        <i class="fas fa-eye"></i> Preview
                    </button>
                </div>
                
                <!-- Preview Area -->
                <div class="preview-area" id="previewArea">
                    <h3>Content Preview:</h3>
                    <div id="previewContent"></div>
                </div>
            </div>
            
            <hr style="margin: 40px 0; border: 1px solid #ddd;">
            
            <!-- Content Management List -->
            <div id="contentManagementSection">
                <h2>Manage Existing Content</h2>
                <div id="contentList">
                    <div class="loading">Loading content...</div>
                </div>
            </div>
            
        </div>
    </div>
    
    <script src="../content.js"></script>
    <script>
        // Global variables
        let editingContentId = null;
        
        // Login function
        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'portfolio2024') {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
                initializeManagement();
            } else {
                alert('Incorrect password! Try: portfolio2024');
            }
        }
        
        // Initialize management interface
        function initializeManagement() {
            console.log('Initializing management...');
            loadCategoriesIntoForm();
            loadContentManagement();
        }
        
        // Load categories into form dropdown
        function loadCategoriesIntoForm() {
            console.log('Loading categories...');
            const categories = getStoredCategories();
            const categorySelect = document.getElementById('contentCategory');
            
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            
            if (Object.keys(categories).length === 0) {
                console.log('No categories found');
                categorySelect.innerHTML += '<option value="" disabled>No categories available - create some first</option>';
                return;
            }
            
            Object.keys(categories)
                .sort((a, b) => categories[a].order - categories[b].order)
                .forEach(catName => {
                    categorySelect.innerHTML += `<option value="${catName}">${catName}</option>`;
                });
            
            console.log('Categories loaded:', Object.keys(categories));
        }
        
        // Update subcategory options when category changes
        function updateSubcategoryOptions() {
            console.log('Updating subcategories...');
            const categoryName = document.getElementById('contentCategory').value;
            const subcategorySelect = document.getElementById('contentSubcategory');
            
            subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
            
            if (categoryName) {
                const categories = getStoredCategories();
                const subcats = categories[categoryName]?.subcategories || {};
                
                if (Object.keys(subcats).length === 0) {
                    subcategorySelect.innerHTML += '<option value="" disabled>No subcategories available</option>';
                    return;
                }
                
                Object.keys(subcats)
                    .sort((a, b) => subcats[a].order - subcats[b].order)
                    .forEach(subName => {
                        subcategorySelect.innerHTML += `<option value="${subName}">${subName}</option>`;
                    });
                
                console.log('Subcategories loaded for', categoryName, ':', Object.keys(subcats));
            }
        }
        
        // Load and display all content for management
        function loadContentManagement() {
            console.log('Loading content management...');
            const allContent = getAllContent();
            const contentList = document.getElementById('contentList');
            
            if (allContent.length === 0) {
                contentList.innerHTML = `
                    <div class="no-content-management">
                        <h3>No content yet</h3>
                        <p>Create your first piece of content using the form above.</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">';
            
            allContent.forEach(item => {
                const preview = getContentPreview(item.content);
                html += `
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase;">
                                ${item.type}
                            </span>
                            <div>
                                <button onclick="editContent(${item.id})" style="background: #3498db; color: white; border: none; padding: 6px 10px; border-radius: 4px; margin-right: 5px; cursor: pointer;" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteContent(${item.id})" style="background: #e74c3c; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer;" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <h4 style="margin-bottom: 10px; color: #2c3e50;">${item.title}</h4>
                        <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">
                            ${item.category} ‚Üí ${item.subcategory} ‚Ä¢ ${formatDate(item.dateCreated)}
                        </div>
                        <div style="color: #6c757d; font-size: 0.9rem;">
                            ${preview}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            contentList.innerHTML = html;
            console.log('Content management loaded, items:', allContent.length);
        }
        
        // Get content preview (first 150 characters)
        function getContentPreview(content) {
            const textContent = content.replace(/<[^>]*>/g, ''); // Strip HTML
            if (textContent.length <= 150) return textContent;
            return textContent.substring(0, 150) + '...';
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Edit existing content
        function editContent(contentId) {
            console.log('Editing content:', contentId);
            const allContent = getAllContent();
            const contentItem = allContent.find(item => item.id == contentId);
            
            if (!contentItem) {
                alert('Content not found!');
                return;
            }
            
            editingContentId = contentId;
            
            // Populate form
            document.getElementById('contentTitle').value = contentItem.title;
            document.getElementById('contentType').value = contentItem.type;
            document.getElementById('mediaUrl').value = contentItem.mediaUrl || '';
            document.getElementById('contentCategory').value = contentItem.category;
            document.getElementById('sidebarTitle').value = contentItem.sidebarTitle || '';
            document.getElementById('sidebarSubtitle').value = contentItem.sidebarSubtitle || '';
            document.getElementById('contentEditor').value = contentItem.content;
            
            // Update subcategories and select the right one
            updateSubcategoryOptions();
            setTimeout(() => {
                document.getElementById('contentSubcategory').value = contentItem.subcategory;
            }, 100);
            
            // Update UI for edit mode
            document.getElementById('buttonText').textContent = 'Update Content';
            document.getElementById('cancelEditBtn').style.display = 'inline-block';
            
            // Scroll to form
            document.getElementById('contentFormSection').scrollIntoView({ behavior: 'smooth' });
            
            showSuccess(`Now editing: "${contentItem.title}"`);
        }
        
        // Delete content
        function deleteContent(contentId) {
            console.log('Deleting content:', contentId);
            const allContent = getAllContent();
            const contentItem = allContent.find(item => item.id == contentId);
            
            if (!contentItem) {
                alert('Content not found!');
                return;
            }
            
            const confirmation = confirm(`Are you sure you want to delete "${contentItem.title}"?\n\nThis action cannot be undone.`);
            
            if (!confirmation) return;
            
            // Remove from storage
            const portfolioContent = getStoredContent();
            const contentType = contentItem.type + 's';
            const contentArray = portfolioContent[contentType];
            
            const itemIndex = contentArray.findIndex(item => item.id == contentId);
            if (itemIndex > -1) {
                contentArray.splice(itemIndex, 1);
                saveContent(portfolioContent);
                
                loadContentManagement();
                showSuccess(`"${contentItem.title}" has been deleted.`);
            }
        }
        
        // Cancel edit mode
        function cancelEdit() {
            editingContentId = null;
            
            // Clear form
            document.getElementById('contentTitle').value = '';
            document.getElementById('contentType').value = 'article';
            document.getElementById('mediaUrl').value = '';
            document.getElementById('contentCategory').value = '';
            document.getElementById('contentSubcategory').value = '';
            document.getElementById('sidebarTitle').value = '';
            document.getElementById('sidebarSubtitle').value = '';
            document.getElementById('contentEditor').value = '';
            
            // Reset UI
            document.getElementById('buttonText').textContent = 'Add Content';
            document.getElementById('cancelEditBtn').style.display = 'none';
            document.getElementById('previewArea').style.display = 'none';
            
            showSuccess('Edit cancelled');
        }
        
        // Publish content (add new or update existing)
        function publishContent() {
            const title = document.getElementById('contentTitle').value.trim();
            const content = document.getElementById('contentEditor').value.trim();
            const category = document.getElementById('contentCategory').value;
            const subcategory = document.getElementById('contentSubcategory').value;
            const contentType = document.getElementById('contentType').value;
            const mediaUrl = document.getElementById('mediaUrl').value.trim();
            const sidebarTitle = document.getElementById('sidebarTitle').value.trim();
            const sidebarSubtitle = document.getElementById('sidebarSubtitle').value.trim();
            
            if (!title) {
                alert('Please enter a title.');
                return;
            }
            
            if (!content) {
                alert('Please enter some content.');
                return;
            }
            
            if (!category || !subcategory) {
                alert('Please select both category and subcategory.');
                return;
            }
            
            const contentData = {
                title: title,
                content: content,
                mediaUrl: mediaUrl,
                type: contentType,
                category: category,
                subcategory: subcategory,
                sidebarTitle: sidebarTitle || title,
                sidebarSubtitle: sidebarSubtitle
            };
            
            if (editingContentId) {
                // Update existing content
                updateExistingContent(editingContentId, contentData);
                showSuccess(`Content "${title}" has been updated successfully!`);
            } else {
                // Add new content
                addContent(contentData);
                showSuccess(`Content "${title}" has been added successfully!`);
            }
            
            // Clear form and refresh
            cancelEdit();
            loadContentManagement();
        }
        
        // Update existing content in storage
        function updateExistingContent(contentId, newData) {
            const portfolioContent = getStoredContent();
            
            let foundItem = null;
            
            ['articles', 'images', 'videos'].forEach(type => {
                const array = portfolioContent[type];
                const item = array.find(item => item.id == contentId);
                if (item) {
                    foundItem = item;
                }
            });
            
            if (foundItem) {
                Object.assign(foundItem, newData);
                foundItem.dateModified = new Date().toISOString().split('T')[0];
                saveContent(portfolioContent);
            }
        }
        
        // Preview content
        function previewContent() {
            const title = document.getElementById('contentTitle').value;
            const content = document.getElementById('contentEditor').value;
            const mediaUrl = document.getElementById('mediaUrl').value;
            const contentType = document.getElementById('contentType').value;
            
            if (!title) {
                alert('Please enter a title to preview.');
                return;
            }
            
            let previewHTML = `<h2>${title}</h2>`;
            
            if (contentType === 'image' && mediaUrl) {
                previewHTML += `<img src="${mediaUrl}" style="max-width: 100%; height: auto; margin: 15px 0;" alt="${title}">`;
            } else if (contentType === 'video' && mediaUrl) {
                if (mediaUrl.includes('youtube.com') || mediaUrl.includes('youtu.be')) {
                    const videoId = mediaUrl.includes('youtu.be') ? 
                        mediaUrl.split('/').pop() : 
                        mediaUrl.split('v=')[1]?.split('&')[0];
                    previewHTML += `<iframe width="100%" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen style="margin: 15px 0;"></iframe>`;
                } else {
                    previewHTML += `<video controls style="max-width: 100%; margin: 15px 0;"><source src="${mediaUrl}"></video>`;
                }
            }
            
            previewHTML += `<div style="margin-top: 15px;">${content}</div>`;
            
            document.getElementById('previewContent').innerHTML = previewHTML;
            document.getElementById('previewArea').style.display = 'block';
        }
        
        // Show success message
        function showSuccess(message) {
            // Simple alert for now - we can enhance this later
            const successDiv = document.createElement('div');
            successDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.2);';
            successDiv.textContent = '‚úÖ ' + message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                document.body.removeChild(successDiv);
            }, 3000);
        }
        
        // Enter key to login
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>